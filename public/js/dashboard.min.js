$(document).ready(function(){function f(){$("#Client-Table tbody tr").remove(),$("#Client-Table tbody").load("dashboard/load_clients",function(){$("#Client-Table tbody tr").click(function(){i(this,"#Client-Table")}),i($("#Client-Table tbody tr:first"),"#Client-Table")})}function g(){$("#Ticket-Table tbody tr").remove(),$("#Ticket-Table tbody").load("dashboard/load_tickets",function(){$("#Ticket-Table tbody tr").click(function(){i(this,"#Ticket-Table")}),l(),i($("#Ticket-Table tbody tr:first"),"#Ticket-Table")})}function h(){$("#User-Table tbody tr").remove(),$("#User-Table tbody").load("dashboard/load_users",function(){$("#User-Table tbody tr").click(function(){i(this,"#User-Table")}),i($("#User-Table tbody tr:first"),"#User-Table")})}function i(a,e){$(e).find(".bg-info").removeClass("bg-info"),$(a).addClass("bg-info"),"#Client-Table"===e?b={name:$(a).children(".name").html(),email:$(a).children(".email").html(),phone:$(a).children(".phone").html(),city:$(a).children(".city").html(),address:$(a).children(".address").html(),id:$(a).children(".id").html()}:"#Ticket-Table"===e?c={date_created:$(a).children(".date").html(),client:$(a).children(".client").html(),service:$(a).children(".service").html(),technician:$(a).children(".technician").html(),status:$(a).children(".status").html(),id:$(a).children(".id").html(),description:$(a).children(".description").html(),invoice:$(a).children(".invoice").html()}:"#User-Table"===e&&(d={name:$(a).children(".name").html(),email:$(a).children(".email").html(),id:$(a).children(".id").html()})}function j(){"#Tab-Clients"===a?($("#Client-Modal #name").val(""),$("#Client-Modal #email").val(""),$("#Client-Modal #phone").val(""),$("#Client-Modal #city").val(""),$("#Client-Modal #address").val(""),$("#Client-Modal #id").val(""),$("#Client-Modal #Errors").html(""),$("#Client-Modal #Errors").hide()):"#Tab-Tickets"===a?($("#Ticket-Modal #client").select2("val",""),$("#Ticket-Modal #date_created").val(""),$("#Ticket-Modal #technician").select2("val",""),$("#Ticket-Modal #invoice").val(""),$("#Ticket-Modal #description").val(""),$("#Ticket-Modal #id").val(""),$("#Ticket-Modal #Errors").html(""),$("#Ticket-Modal #Errors").hide()):"#Tab-Users"===a&&($("#User-Modal #name").val(""),$("#User-Modal #email").val(""),$("#User-Modal #id").val(""))}function k(){"#Tab-Clients"===a?($("#Client-Modal #name").val(b.name),$("#Client-Modal #email").val(b.email),$("#Client-Modal #phone").val(b.phone),$("#Client-Modal #city").val(b.city),$("#Client-Modal #address").val(b.address),$("#Client-Modal #id").val(b.id),$("#Client-Modal #Errors").html(""),$("#Client-Modal #Errors").hide()):"#Tab-Tickets"===a?($("#Ticket-Modal #date_created").val(c.date_created),$("#Ticket-Modal #client").select2("data",{id:c.client,text:c.client}),$("#Ticket-Modal #service").val(c.service),$("#Ticket-Modal #technician").select2("data",{id:c.technician,text:c.technician}),$("#Ticket-Modal #description").val(c.description),$("#Ticket-Modal #status").val(c.status),$("#Ticket-Modal #id").val(c.id),$("#Ticket-Modal #invoice").val(c.invoice),$("#Ticket-Modal #Errors").html(c.Errors),$("#Ticket-Modal #Errors").hide()):"#Tab-Users"===a&&($("#User-Modal #name").val(d.name),$("#User-Modal #email").val(d.email),$("#User-Modal #id").val(d.id))}function l(){var a=[],b=[];$.get("dashboard/get_people",function(c){$(c.clients).each(function(b,c){a.push({id:b,text:c.name})}),$("#Ticket-Modal #client").select2({data:a,id:function(a){return a.text}}),$(c.technicians).each(function(a,c){b.push({id:a,text:c.name})}),$("#Ticket-Modal #technician").select2({data:b,id:function(a){return a.text}})})}function m(b){"#Tab-Clients"===a?($("#Tab-Clients #Success").show(),$("#Tab-Clients #Success .message").html(b)):"#Tab-Tickets"===a?($("#Tab-Tickets #Success").show(),$("#Tab-Tickets #Success .message").html(b)):"#Tab-Users"===a&&($("#Tab-Users #Success").show(),$("#Tab-Users #Success .message").html(b))}function n(b){"#Tab-Clients"===a?($("#Tab-Clients #Errors").show(),$("#Tab-Clients #Errors .message").html(b)):"#Tab-Tickets"===a?($("#Tab-Tickets #Errors").show(),$("#Tab-Tickets #Errors .message").html(b)):"#Tab-Users"===a&&($("#Tab-Users #Errors").show(),$("#Tab-Users #Errors .message").html(b))}function o(a,b){var c=a.val().toLowerCase(),d=$(b+" tbody tr");c.length>2?d.show().filter(function(){var b=$(this).text().toLowerCase();return-1===b.search(c)}).hide():d.show()}var b,c,d,a="#Tab-Clients",e=!1;f(),g(),h(),$(".nav-tabs a").click(function(b){b.preventDefault(),$(this).tab("show"),a=$(this).attr("href")}),$("#Tab-Clients #Success").hide(),$("#Tab-Clients #Errors").hide(),$("#Tab-Tickets #Success").hide(),$("#Tab-Tickets #Errors").hide(),$("#Tab-Users #Success").hide(),$("#Tab-Users #Errors").hide(),$("#Form-Client #Errors").hide(),$("#Form-Ticket #Errors").hide(),$("#Form-User #Errors").hide(),$("#Client-Modal").modal({show:!1}).on("hidden.bs.modal",function(){j()}),$("#Ticket-Modal").modal({show:!1}).on("hidden.bs.modal",function(){j()}),$("#Ticket-Modal #date_created").datepicker({format:"dd M yyyy",autoclose:!0,todayHighlight:!0}),$("#Ticket-Modal #service").select2({minimumResultsForSearch:-1}),$("#Ticket-Modal #status").select2({minimumResultsForSearch:-1}),$("#User-Modal").modal({show:!1}).on("hidden.bs.modal",function(){j()}),$(".alert button").click(function(){$(this).parent().hide()}),$("#Btn-Create-Client").click(function(a){$("#Client-Modal").modal("show"),e=!1,a.preventDefault()}),$("#Btn-Edit-Client").click(function(a){$("#Client-Modal").modal("show"),k(),e=!0,a.preventDefault()}),$("#Btn-Refresh-Client").click(function(a){f(),a.preventDefault()}),$("#Search-Client").keyup(function(){o($(this),"#Client-Table")}),$("#Btn-Delete-Client").click(function(){$(this).confirmation("destroy").confirmation({popout:!0,btnOkClass:"btn-sm btn-danger",btnOkIcon:"fa fa-check",btnCancelClass:"btn-sm btn-default",btnCancelIcon:"fa fa-times",title:"Delete "+b.name+"?",placement:"right",onConfirm:function(){$.post("/dashboard/delete_client",b,function(a){a.error?n(a.error):(a.success&&m(b.name+" deleted successfully"),f(),l())})}}).confirmation("show")}),$("#Form-Client").submit(function(a){var b="/dashboard";b+=e?"/edit_client":"/create_client",$.post(b,$("#Form-Client").serialize(),function(a){a.error?($("#Form-Client #Errors").html("").show(),$.each(a.error,function(a,b){$("#Form-Client #Errors").append(b).append("<br />")})):(a.success&&m(a.success),$("#Client-Modal").modal("hide"),f(),g(),l())}),a.preventDefault()}),$("#Btn-Create-Ticket").click(function(a){$("#Ticket-Modal").modal("show"),e=!1,a.preventDefault()}),$("#Btn-View-Ticket").click(function(a){$("#Ticket-Modal").modal("show"),e=!0,k(),a.preventDefault()}),$("#Btn-Refresh-Ticket").click(function(a){g(),a.preventDefault()}),$("#Search-Ticket").keyup(function(){o($(this),"#Ticket-Table")}),$("#Form-Ticket").submit(function(a){var b="/dashboard";b+=e?"/edit_ticket":"/create_ticket",$.post(b,$("#Form-Ticket").serialize(),function(a){a.error?($("#Form-Ticket #Errors").html("").show(),$.each(a.error,function(a,b){$("#Form-Ticket #Errors").append(b).append("<br />")})):(a.success&&m(a.success),$("#Ticket-Modal").modal("hide"),g())}),a.preventDefault()}),$("#Btn-Delete-Ticket").click(function(){$(this).confirmation("destroy").confirmation({popout:!0,btnOkClass:"btn-sm btn-danger",btnOkIcon:"fa fa-check",btnCancelClass:"btn-sm btn-default",btnCancelIcon:"fa fa-times",title:"Delete "+c.date_created+" - "+c.client+"?",placement:"right",onConfirm:function(){$.post("/dashboard/delete_ticket",c,function(a){a.error?n(a.error):(m(c.date_created+" - "+c.client+" deleted successfully"),g())})}}).confirmation("show")}),$("#Btn-Edit-User").click(function(a){$("#User-Modal").modal("show"),e=!0,k(),a.preventDefault()}),$("#Btn-Refresh-User").click(function(a){h(),a.preventDefault()}),$("#Search-User").keyup(function(){o($(this),"#User-Table")}),$("#Form-User").submit(function(a){var b="/dashboard/edit_user";$.post(b,$("#Form-User").serialize(),function(a){a.error?($("#Form-User #Errors").html("").show(),$.each(a.error,function(a,b){$("#Form-User #Errors").append(b).append("<br />")})):(a.success&&m(a.success),$("#User-Modal").modal("hide"),h(),g(),l())}),a.preventDefault()}),$("#Btn-Delete-User").click(function(){$(this).confirmation("destroy").confirmation({popout:!0,btnOkClass:"btn-sm btn-danger",btnOkIcon:"fa fa-check",btnCancelClass:"btn-sm btn-default",btnCancelIcon:"fa fa-times",title:"Delete "+d.name+"?",placement:"right",onConfirm:function(){$.post("/dashboard/delete_user",d,function(a){a.error?n(a.error):(m(d.name+" deleted successfully"),h(),g())})}}).confirmation("show")})});